<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<book>
  <bookinfo>
    <title><trademark class="registered">NETWAYS</trademark> LConf
    Documentation</title>

    <author>
      <firstname>Tobias Redel</firstname>

      <affiliation>
        <orgname><trademark class="registered">NETWAYS</trademark>
        GmbH</orgname>
      </affiliation>
    </author>

    <pubdate>2010-03-01</pubdate>

    <revhistory>
      <revision>
        <date>0.1 2010-04-20 * initial draft</date>
      </revision>
    </revhistory>
  </bookinfo>

  <chapter>
    <title>Introduction</title>

    <para><trademark class="registered">NETWAYS</trademark> LConf is a LDAP
    based configuration tool for <trademark
    class="registered">Icinga</trademark> and <trademark
    class="registered">Nagios</trademark>. All configuration elements are
    stored on a LDAP server and exported to text-based configuration files.
    <trademark class="registered">Icinga</trademark> / <trademark
    class="registered">Nagios</trademark> uses only these config files and
    will work independent from the LDAP during his runtime.</para>

    <para>This software is still under development. In the case of bugs or
    errors, please do not hesitate inform our team at
    http://www.netways.org</para>
  </chapter>

  <chapter>
    <title>Installation</title>

    <para>This chapter entails the installation and software requirements of
    <trademark class="registered">NETWAYS</trademark> LConf.</para>

    <para>Please note that package names or installation commands vary with
    the different Linux distributions e.g. Debian, SuSE, and RedHat.</para>

    <sect1>
      <title>Requirements</title>

      <para>The following Packages are required for successfull installation
      of <trademark class="registered">NETWAYS</trademark> LConf.</para>

      <itemizedlist>
        <listitem>
          <para>OpenLDAP 2.3 or higher</para>
        </listitem>
      </itemizedlist>

      <itemizedlist>
        <listitem>
          <para>Perl with ldap libs (e.g. libnet-ldap-perl and
          perl-LDAP)</para>
        </listitem>
      </itemizedlist>

      <itemizedlist>
        <listitem>
          <para>Operationg system's ldap utils</para>
        </listitem>
      </itemizedlist>
    </sect1>

    <sect1>
      <title>Getting and installing LConf</title>

      <orderedlist>
        <listitem>
          <para>Download <trademark class="registered">NETWAYS</trademark>
          LConf.</para>

          <para>The installation package is available on <link
          linkend="www.netways.org">http://www.netways.org</link>.</para>
        </listitem>

        <listitem>
          <para>Extract the downloaded archive.</para>

          <para><code>lconf-doku:/usr/local/src# tar -xvzf
          LConf-0.8.tar.gz</code></para>
        </listitem>

        <listitem>
          <para>Execute the install wizard</para>

          <para><code>lconf-doku:/usr/local/src/LConf-0.8# ./install.sh
          </code></para>
        </listitem>

        <listitem>
          <para>Now, follow the wizard's instructions</para>
        </listitem>

        <listitem>
          <para>Add a custom dir to your <trademark
          class="registered">Icinga</trademark> / <trademark
          class="registered">Nagios</trademark> configuration (e.g.
          icinga.cfg)</para>

          <para><code>cfg_dir=/usr/local/icinga/etc/MyCustomConfig</code></para>
        </listitem>
      </orderedlist>
    </sect1>
  </chapter>

  <chapter>
    <title>Basics</title>

    <sect1>
      <title>Base setup</title>

      <para>Because of completeness and security, all hosts, services and
      contacts generated by LConf will refer to a template. So you have to
      configure these base templates once. After that templates can be
      overridden as usual in <trademark class="registered">Icinga</trademark>
      / <trademark class="registered">Nagios</trademark>.</para>

      <para>The config file for default templtes can be found in
      $PREFIX/etc/default-templates.cfg. Customize it to your personal
      needs.</para>
    </sect1>

    <sect1>
      <title>The LDAP Tree</title>

      <para>After connecting with your LDAP browser to the LDAP Server, you
      could see that LConf has created different Items.</para>

      <para>ou=LConf is LConf's base dir. Each LConf script will search below
      this ou.</para>

      <para>ou=Examples contains some sample items for each ldap objectclass
      (see Chapter 3, 3.5 LDAP Objectclasses).</para>

      <para>ou=Templates can contain your config templates. It's only a
      suggestion. Rename it as you want. Delete it. Never mind ;-)</para>

      <mediaobject>
        <imageobject>
          <imagedata align="left"
                     fileref="Screenshots/Chapter%203%20-%20Section%203%20-%20Pic%201.png" />
        </imageobject>
      </mediaobject>
    </sect1>

    <sect1>
      <title>LDAP Objectclasses</title>

      <para>A LDAP Server is organized in attributes and object classes. An
      object class specifies a set of attributes used to describe an object.
      For example, the objectClass nagiosHost contains attributes associated
      with a <trademark class="registered">Icinga</trademark> / <trademark
      class="registered">Nagios</trademark> Host such as address, parent or
      contacts.</para>

      <para>LConf object classes namend very visceral. For example the object
      class for timeperiods is called nagiosTimeperiod, the object class for
      commands is called nagiosCommand and so on...</para>

      <para>The following object classes are available:</para>

      <itemizedlist>
        <listitem>
          <para>nagiosTimeperiod</para>
        </listitem>

        <listitem>
          <para>nagiosCommand</para>
        </listitem>

        <listitem>
          <para>nagiosContact</para>
        </listitem>

        <listitem>
          <para>nagiosContactgroup</para>
        </listitem>

        <listitem>
          <para>nagiosHost</para>
        </listitem>

        <listitem>
          <para>nagiosHostgroup</para>
        </listitem>

        <listitem>
          <para>nagiosService</para>
        </listitem>

        <listitem>
          <para>nagiosStructuralObject</para>
        </listitem>
      </itemizedlist>

      <para>The special object class nagiosStructuralObject is used for
      attribute inheritance and will be described in Chapter 4, 2.10</para>
    </sect1>

    <sect1>
      <title>Export a <trademark class="registered">Icinga</trademark> /
      <trademark class="registered">Nagios</trademark> configuration</title>

      <para>Basicly, to generate / export a configuration vom LConf to
      <trademark class="registered">Icinga</trademark> / <trademark
      class="registered">Nagios</trademark> you have to run LConfExport.pl.
      The Script can be found in your LConf main dir.</para>

      <para>Due to different problems with file permissions LConfExport.pl can
      only be executed by user you specified during installation. In this
      example LConf was installed with user nagios.</para>

      <para><code>nagios@lconf-doku:/usr/local/LConf$ ./LConfExport.pl -o
      /usr/local/nagios/etc/MyCustomConfig/ </code></para>
    </sect1>
  </chapter>

  <chapter>
    <title>The Power of LConf</title>

    <sect1>
      <title><trademark class="registered">Icinga</trademark> / <trademark
      class="registered">Nagios</trademark> Basiskonfiguration</title>

      <sect2 id="collector-dependencies">
        <title>Timeperiods</title>

        <para>For adding a new timeperiod to LConf, just create a new LDAP
        entry and choose object class nagiosTimeperiod. A bit special are the
        attributes cn and description. cn will be the title of the entry and
        description is an additional attribute for leaving comments.
        Everything else you can treat like a <trademark
        class="registered">Icinga</trademark> / <trademark
        class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%202.1%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>

        <para>Of course, the attribute nagiosTimeperiodValue can be defined
        multiple times...</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%202.1%20-%20Pic%202.png" />
          </imageobject>
        </mediaobject>

        <para>After running LConfExport.pl the config file will look like
        this:</para>

        <para><code>define timeperiod {</code></para>

        <para><code> sunday 00:00-24:00</code></para>

        <para><code> monday 00:00-24:00</code></para>

        <para><code> tuesday 00:00-24:00</code></para>

        <para><code> wednesday 00:00-24:00</code></para>

        <para><code> thursday 00:00-24:00</code></para>

        <para><code> friday 00:00-24:00</code></para>

        <para><code> saturday 00:00-24:00</code></para>

        <para><code> alias 24 Hours A Day, 7 Days A Week timeperiod_name 24x7
        </code></para>

        <para><code>} </code></para>
      </sect2>

      <sect2 id="collector-dependencies">
        <title>Commands</title>

        <para>For adding a new command to LConf, just create a new LDAP entry
        and choose object class nagiosCommand. A bit special are the
        attributes cn and description. cn will be the title of the entry and
        description is an additional attribute for leaving comments.
        Everything else you can treat like a <trademark
        class="registered">Icinga</trademark> / <trademark
        class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%202.2%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>

        <para>After running LConfExport.pl the config file will look like
        this:</para>

        <para><code>define command {</code></para>

        <para><code> command_line $USER1$/check_ping -H $HOSTADDRESS$ -w
        3000.0,80% -c 5000.0,100% -p 5</code></para>

        <para><code> command_name check-host-alive</code></para>

        <para><code>} </code></para>
      </sect2>

      <sect2 id="collector-dependencies">
        <title>Contacts</title>

        <para>For adding a new contact to LConf, just create a new LDAP entry
        and choose object class nagiosContact. A bit special are the
        attributes cn and description. cn will be the title of the entry and
        description is an additional attribute for leaving comments.
        Everything else you can treat like a <trademark
        class="registered">Icinga</trademark> / <trademark
        class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%202.3%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>

        <para>After running LConfExport.pl the config file will look like
        this:</para>

        <para><code>define contact {</code></para>

        <para><code> use generic-contact</code></para>

        <para><code> contact_name nagiosadmin</code></para>

        <para><code> email nagiosadmin@netways.org</code></para>

        <para><code> alias Nagios Admin</code></para>

        <para><code>}</code></para>
      </sect2>

      <sect2 id="collector-dependencies">
        <title>Contactgroups</title>

        <para>For adding a new contactgroup to LConf, just create a new LDAP
        entry and choose object class nagiosContactgroup. A bit special are
        the attributes cn and description. cn will be the title of the entry
        and description is an additional attribute for leaving comments.
        Everything else you can treat like a <trademark
        class="registered">Icinga</trademark> / <trademark
        class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%202.4%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>

        <para>After running LConfExport.pl the config file will look like
        this:</para>

        <para><code>define contactgroup {</code></para>

        <para><code> contactgroup_name admins</code></para>

        <para><code> alias Nagios Administrators</code></para>

        <para><code> members nagiosadmin </code></para>

        <para><code>}</code></para>
      </sect2>
    </sect1>

    <sect1 id="installing">
      <title>Hosts</title>

      <para>For adding a new host to LConf, just create a new LDAP entry and
      choose object class nagiosHost. A bit special are the attributes cn and
      description. cn will be the title of the entry and description is an
      additional attribute for leaving comments. Everything else you can treat
      like a <trademark class="registered">Icinga</trademark> / <trademark
      class="registered">Nagios</trademark> config.</para>

      <mediaobject>
        <imageobject>
          <imagedata align="left"
                     fileref="Screenshots/Chapter%204%20-%20Section%203%20-%20Pic%201.png" />
        </imageobject>
      </mediaobject>

      <para>After running LConfExport.pl the config file will look like
      this:</para>

      <para><code>define host {</code></para>

      <para><code> use generic-host</code></para>

      <para><code> host_name localhost</code></para>

      <para><code> alias localhost</code></para>

      <para><code> address 127.0.0.1</code></para>

      <para><code>}</code></para>
    </sect1>

    <sect1 id="installing">
      <title>Services</title>

      <para>For adding a new service to LConf, just create a new LDAP entry
      and choose object class nagiosService. A bit special are the attributes
      cn and description. cn will be the title of the entry and description is
      an additional attribute for leaving comments. Everything else you can
      treat like a <trademark class="registered">Icinga</trademark> /
      <trademark class="registered">Nagios</trademark> config.</para>

      <mediaobject>
        <imageobject>
          <imagedata align="left"
                     fileref="Screenshots/Chapter%204%20-%20Section%204%20-%20Pic%201.png" />
        </imageobject>
      </mediaobject>

      <para>To assign a service to a host, simply create or move the service
      below a host object class.</para>

      <para><mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%204%20-%20Pic%202.png" />
          </imageobject>
        </mediaobject></para>

      <para>After running LConfExport.pl hosts config file will look like
      this:</para>

      <para><code><code>define host {</code></code></para>

      <para><code> use generic-host</code></para>

      <para><code> host_name localhost</code></para>

      <para><code> alias localhost</code></para>

      <para><code> address 127.0.0.1</code></para>

      <para><code>}</code></para>

      <para><code></code></para>

      <para><code>define service {</code></para>

      <para><code> use generic-service </code></para>

      <para><code> service_description PING </code></para>

      <para><code> host_name localhost</code></para>

      <para><code> check_command check_ping!100.0,20%!500.0,60%</code></para>

      <para><code>} </code></para>
    </sect1>

    <sect1 id="installing">
      <title>Custom Objektvariablen</title>

      <para>Adding customvars to hosts or services is just as easy. For hosts,
      fill the nagiosHostCustomvar attribute, for services the
      nagiosServiceCustomvar attribute. The fist part of the line, e.g.
      _MYCUSTOMVAR (till a space) represents the name of the customvar, the
      second part (from space) will be customvars value.</para>

      <para><mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%205%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject></para>

      <para>Of course, the attributes nagiosHostCustomvar and
      nagiosServiceCustomvar can be defined multiple times...</para>

      <mediaobject>
        <imageobject>
          <imagedata align="left"
                     fileref="Screenshots/Chapter%204%20-%20Section%205%20-%20Pic%202.png" />
        </imageobject>
      </mediaobject>

      <para>After running LConfExport.pl the config file will look like
      this:</para>

      <para><code><code>define host {</code></code></para>

      <para><code> use generic-host</code></para>

      <para><code> host_name localhost</code></para>

      <para><code> alias localhost</code></para>

      <para><code> address 127.0.0.1</code></para>

      <para><code> _ANOTHERCUSTOMVAR test2</code></para>

      <para><code> _MYCUSTOMVAR test</code></para>

      <para><code>}</code></para>
    </sect1>

    <sect1>
      <title>Hostgroups</title>

      <para>You can define hostgroups in two ways. To define by object class
      nagiosHostgroups is just as possible as define by object class
      nagiosHost. Do it in the way you want.</para>

      <sect2 id="collector-dependencies">
        <title>Object class nagiosHostgroup</title>

        <para>For adding a new Hostgroup to LConf, just create a new LDAP
        entry and choose object class nagiosHostgroup. A bit special are the
        attributes cn and description. cn will be the title of the entry and
        description is an additional attribute for leaving comments.
        Everything else you can treat like a <trademark
        class="registered">Icinga</trademark> / <trademark
        class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%206.1%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>
      </sect2>

      <sect2 id="collector-dependencies">
        <title>Object class nagiosHost</title>

        <para>For adding a host to a hostgroup, just edit the existing LDAP
        host entry at the attribute nagiosHostgroups. You can treat the
        attribute like a <trademark class="registered">Icinga</trademark> /
        <trademark class="registered">Nagios</trademark> config.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%206.2%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>
      </sect2>

      <sect2 id="collector-dependencies">
        <title>Assign a services to a hostgroup</title>

        <para>To assign a service (see Chapter 4, 4 Services) to a hostgroup,
        simply create or move the service below a hostgroup object class. All
        hosts in this hostgroup will get this service after running
        LConfExport.pl.</para>

        <mediaobject>
          <imageobject>
            <imagedata align="left"
                       fileref="Screenshots/Chapter%204%20-%20Section%206.3%20-%20Pic%201.png" />
          </imageobject>
        </mediaobject>
      </sect2>
    </sect1>
  </chapter>

  <chapter></chapter>
</book>
