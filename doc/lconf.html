<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd"> <HTML ><HEAD ><TITLE >NETWAYS LConf     Documentation</TITLE ><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD ><BODY CLASS="book" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#840084" ALINK="#0000FF" ><DIV CLASS="BOOK" ><A NAME="AEN1" ></A ><DIV CLASS="TITLEPAGE" ><H1 CLASS="title" ><A NAME="AEN2" ><SPAN CLASS="trademark" >NETWAYS</SPAN >&reg; LConf     Documentation</A ></H1 ><H3 CLASS="author" ><A NAME="AEN5" ></A >Tobias Redel</H3 ><DIV CLASS="affiliation" ><SPAN CLASS="orgname" ><SPAN CLASS="trademark" >NETWAYS</SPAN >&reg;         GmbH<BR></SPAN ></DIV ><HR></DIV ><DIV CLASS="TOC" ><DL ><DT ><B >Table of Contents</B ></DT ><DT >1. <A HREF="#AEN16" >Introduction</A ></DT ><DT >2. <A HREF="#AEN25" >Installation</A ></DT ><DD ><DL ><DT >2.1. <A HREF="#AEN30" >Requirements</A ></DT ><DT >2.2. <A HREF="#AEN43" >Getting and installing LConf</A ></DT ></DL ></DD ><DT >3. <A HREF="#AEN66" >Basics</A ></DT ><DD ><DL ><DT >3.1. <A HREF="#AEN68" >Base setup</A ></DT ><DT >3.2. <A HREF="#AEN74" >The LDAP Tree</A ></DT ><DT >3.3. <A HREF="#AEN83" >LDAP Objectclasses</A ></DT ><DT >3.4. <A HREF="#AEN108" >Export a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /       <SPAN CLASS="trademark" >Nagios</SPAN >&reg; configuration</A ></DT ></DL ></DD ><DT >4. <A HREF="#AEN118" >The Power of LConf</A ></DT ><DD ><DL ><DT >4.1. <A HREF="#AEN120" ><SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; basic configuration</A ></DT ><DD ><DL ><DT >4.1.1. <A HREF="#AEN124" >Timeperiods</A ></DT ><DT >4.1.2. <A HREF="#AEN157" >Commands</A ></DT ><DT >4.1.3. <A HREF="#AEN174" >Contacts</A ></DT ><DT >4.1.4. <A HREF="#AEN195" >Contactgroups</A ></DT ></DL ></DD ><DT >4.2. <A HREF="#AEN214" >Hosts</A ></DT ><DT >4.3. <A HREF="#AEN235" >Services</A ></DT ><DT >4.4. <A HREF="#AEN276" >Customvars</A ></DT ><DT >4.5. <A HREF="#AEN305" >Hostgroups</A ></DT ><DD ><DL ><DT >4.5.1. <A HREF="#AEN308" >Object class nagiosHostgroup</A ></DT ><DT >4.5.2. <A HREF="#AEN316" >Object class nagiosHost</A ></DT ><DT >4.5.3. <A HREF="#AEN324" >Assign a services to a hostgroup</A ></DT ></DL ></DD ><DT >4.6. <A HREF="#AEN330" >Host Dependencies</A ></DT ><DT >4.7. <A HREF="#AEN361" >Service Dependencies</A ></DT ><DT >4.8. <A HREF="#AEN426" >Inheritance</A ></DT ><DD ><DL ><DT >4.8.1. <A HREF="#AEN433" >Host attributes</A ></DT ><DT >4.8.2. <A HREF="#AEN509" >Service attributes</A ></DT ><DT >4.8.3. <A HREF="#AEN640" >Services</A ></DT ></DL ></DD ><DT >4.9. <A HREF="#AEN730" >Templates / Profiles</A ></DT ><DT >4.10. <A HREF="#AEN810" >nagiosHostDisable / nagiosServiceDisable</A ></DT ></DL ></DD ><DT >5. <A HREF="#AEN814" >Multiple <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /     <SPAN CLASS="trademark" >Nagios</SPAN >&reg; Servers</A ></DT ><DD ><DL ><DT >5.1. <A HREF="#AEN826" >Export the whole <SPAN CLASS="trademark" >Icinga</SPAN >&reg;       / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; configuration</A ></DT ><DT >5.2. <A HREF="#AEN835" >Tell LConf about multiple servers</A ></DT ><DT >5.3. <A HREF="#AEN844" >Deploy config per server</A ></DT ></DL ></DD ></DL ></DIV ><DIV CLASS="chapter" ><HR><H1 ><A NAME="AEN16" ></A >Chapter 1. Introduction</H1 ><P ><SPAN CLASS="trademark" >NETWAYS</SPAN >&reg; LConf is a LDAP     based configuration tool for <SPAN CLASS="trademark" >Icinga</SPAN >&reg; and <SPAN CLASS="trademark" >Nagios</SPAN >&reg;. All configuration elements are     stored on a LDAP server and exported to text-based configuration files.     <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; uses only these config files and     will work independent from the LDAP during his runtime.</P ><P >This software is still under development. In the case of bugs or     errors, please do not hesitate inform our team at     http://www.netways.org</P ></DIV ><DIV CLASS="chapter" ><HR><H1 ><A NAME="AEN25" ></A >Chapter 2. Installation</H1 ><P >This chapter entails the installation and software requirements of     <SPAN CLASS="trademark" >NETWAYS</SPAN >&reg; LConf.</P ><P >Please note that package names or installation commands vary with     the different Linux distributions e.g. Debian, SuSE, and RedHat.</P ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN30" >2.1. Requirements</A ></H2 ><P >The following Packages are required for successfull installation       of <SPAN CLASS="trademark" >NETWAYS</SPAN >&reg; LConf.</P ><P ></P ><UL ><LI ><P >OpenLDAP 2.3 or higher</P ></LI ></UL ><P ></P ><UL ><LI ><P >Perl with ldap libs (e.g. libnet-ldap-perl and           perl-LDAP)</P ></LI ></UL ><P ></P ><UL ><LI ><P >Operationg system's ldap utils</P ></LI ></UL ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN43" >2.2. Getting and installing LConf</A ></H2 ><P ></P ><OL TYPE="1" ><LI ><P >Download <SPAN CLASS="trademark" >NETWAYS</SPAN >&reg;           LConf.</P ><P >The installation package is available on           http://www.netways.org.</P ></LI ><LI ><P >Extract the downloaded archive.</P ><P ><FONT COLOR="RED" >lconf-doku:/usr/local/src# tar -xvzf           LConf-0.8.tar.gz</FONT ></P ></LI ><LI ><P >Execute the install wizard</P ><P ><FONT COLOR="RED" >lconf-doku:/usr/local/src/LConf-0.8# ./install.sh           </FONT ></P ></LI ><LI ><P >Now, follow the wizard's instructions</P ></LI ><LI ><P >Add a custom dir to your <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; configuration (e.g.           icinga.cfg)</P ><P ><FONT COLOR="RED" >cfg_dir=/usr/local/icinga/etc/MyCustomConfig</FONT ></P ></LI ></OL ></DIV ></DIV ><DIV CLASS="chapter" ><HR><H1 ><A NAME="AEN66" ></A >Chapter 3. Basics</H1 ><DIV CLASS="sect1" ><H2 CLASS="sect1" ><A NAME="AEN68" >3.1. Base setup</A ></H2 ><P >Because of completeness and security, all hosts, services and       contacts generated by LConf will refer to a template. So you have to       configure these base templates once. After that templates can be       overridden as usual in <SPAN CLASS="trademark" >Icinga</SPAN >&reg;       / <SPAN CLASS="trademark" >Nagios</SPAN >&reg;.</P ><P >The config file for default templtes can be found in       $PREFIX/etc/default-templates.cfg. Customize it to your personal       needs.</P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN74" >3.2. The LDAP Tree</A ></H2 ><P >After connecting with your LDAP browser to the LDAP Server, you       could see that LConf has created different Items.</P ><P >ou=LConf is LConf's base dir. Each LConf script will search below       this ou.</P ><P >ou=Examples contains some sample items for each ldap objectclass       (see Chapter 3, 3.5 LDAP Objectclasses).</P ><P >ou=Templates can contain your config templates. It's only a       suggestion. Rename it as you want. Delete it. Never mind ;-)</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN83" >3.3. LDAP Objectclasses</A ></H2 ><P >A LDAP Server is organized in attributes and object classes. An       object class specifies a set of attributes used to describe an object.       For example, the objectClass nagiosHost contains attributes associated       with a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; Host such as address, parent or       contacts.</P ><P >LConf object classes namend very visceral. For example the object       class for timeperiods is called nagiosTimeperiod, the object class for       commands is called nagiosCommand and so on...</P ><P >The following object classes are available:</P ><P ></P ><UL ><LI ><P >nagiosTimeperiod</P ></LI ><LI ><P >nagiosCommand</P ></LI ><LI ><P >nagiosContact</P ></LI ><LI ><P >nagiosContactgroup</P ></LI ><LI ><P >nagiosHost</P ></LI ><LI ><P >nagiosHostgroup</P ></LI ><LI ><P >nagiosService</P ></LI ><LI ><P >nagiosStructuralObject</P ></LI ></UL ><P >The special object class nagiosStructuralObject is used for       attribute inheritance and will be described in Chapter 4, 2.10</P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN108" >3.4. Export a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /       <SPAN CLASS="trademark" >Nagios</SPAN >&reg; configuration</A ></H2 ><P >Basicly, to generate / export a configuration vom LConf to       <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; you have to run LConfExport.pl.       The Script can be found in your LConf main dir.</P ><P >Due to different problems with file permissions LConfExport.pl can       only be executed by user you specified during installation. In this       example LConf was installed with user nagios.</P ><P ><FONT COLOR="RED" >nagios@lconf-doku:/usr/local/LConf$ ./LConfExport.pl -o       /usr/local/nagios/etc/MyCustomConfig/ </FONT ></P ></DIV ></DIV ><DIV CLASS="chapter" ><HR><H1 ><A NAME="AEN118" ></A >Chapter 4. The Power of LConf</H1 ><DIV CLASS="sect1" ><H2 CLASS="sect1" ><A NAME="AEN120" >4.1. <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; basic configuration</A ></H2 ><DIV CLASS="sect2" ><H3 CLASS="sect2" ><A NAME="AEN124" >4.1.1. Timeperiods</A ></H3 ><P >For adding a new timeperiod to LConf, just create a new LDAP         entry and choose object class nagiosTimeperiod. A bit special are the         attributes cn and description. cn will be the title of the entry and         description is an additional attribute for leaving comments.         Everything else you can treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >Of course, the attribute nagiosTimeperiodValue can be defined         multiple times...</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like         this:</P ><P ><FONT COLOR="RED" >define timeperiod {</FONT ></P ><P ><FONT COLOR="RED" > sunday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > monday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > tuesday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > wednesday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > thursday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > friday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > saturday 00:00-24:00</FONT ></P ><P ><FONT COLOR="RED" > alias 24 Hours A Day, 7 Days A Week timeperiod_name 24x7         </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN157" >4.1.2. Commands</A ></H3 ><P >For adding a new command to LConf, just create a new LDAP entry         and choose object class nagiosCommand. A bit special are the         attributes cn and description. cn will be the title of the entry and         description is an additional attribute for leaving comments.         Everything else you can treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like         this:</P ><P ><FONT COLOR="RED" >define command {</FONT ></P ><P ><FONT COLOR="RED" > command_line $USER1$/check_ping -H $HOSTADDRESS$ -w         3000.0,80% -c 5000.0,100% -p 5</FONT ></P ><P ><FONT COLOR="RED" > command_name check-host-alive</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN174" >4.1.3. Contacts</A ></H3 ><P >For adding a new contact to LConf, just create a new LDAP entry         and choose object class nagiosContact. A bit special are the         attributes cn and description. cn will be the title of the entry and         description is an additional attribute for leaving comments.         Everything else you can treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like         this:</P ><P ><FONT COLOR="RED" >define contact {</FONT ></P ><P ><FONT COLOR="RED" > use generic-contact</FONT ></P ><P ><FONT COLOR="RED" > contact_name nagiosadmin</FONT ></P ><P ><FONT COLOR="RED" > email nagiosadmin@netways.org</FONT ></P ><P ><FONT COLOR="RED" > alias Nagios Admin</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN195" >4.1.4. Contactgroups</A ></H3 ><P >For adding a new contactgroup to LConf, just create a new LDAP         entry and choose object class nagiosContactgroup. A bit special are         the attributes cn and description. cn will be the title of the entry         and description is an additional attribute for leaving comments.         Everything else you can treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like         this:</P ><P ><FONT COLOR="RED" >define contactgroup {</FONT ></P ><P ><FONT COLOR="RED" > contactgroup_name admins</FONT ></P ><P ><FONT COLOR="RED" > alias Nagios Administrators</FONT ></P ><P ><FONT COLOR="RED" > members nagiosadmin </FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ></DIV ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN214" >4.2. Hosts</A ></H2 ><P >For adding a new host to LConf, just create a new LDAP entry and       choose object class nagiosHost. A bit special are the attributes cn and       description. cn will be the title of the entry and description is an       additional attribute for leaving comments. Everything else you can treat       like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like       this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > alias localhost</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN235" >4.3. Services</A ></H2 ><P >For adding a new service to LConf, just create a new LDAP entry       and choose object class nagiosService. A bit special are the attributes       cn and description. cn will be the title of the entry and description is       an additional attribute for leaving comments. Everything else you can       treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /       <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >To assign a service to a host, simply create or move the service       below a host object class.</P ><P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></P ><P >After running LConfExport.pl hosts config file will look like       this:</P ><P ><FONT COLOR="RED" ><FONT COLOR="RED" >define host {</FONT ></FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > alias localhost</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service </FONT ></P ><P ><FONT COLOR="RED" > service_description PING </FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN276" >4.4. Customvars</A ></H2 ><P >Adding customvars to hosts or services is just as easy. For hosts,       fill the nagiosHostCustomvar attribute, for services the       nagiosServiceCustomvar attribute. The fist part of the line, e.g.       _MYCUSTOMVAR (till a space) represents the name of the customvar, the       second part (from space) will be customvars value.</P ><P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></P ><P >Of course, the attributes nagiosHostCustomvar and       nagiosServiceCustomvar can be defined multiple times...</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config file will look like       this:</P ><P ><FONT COLOR="RED" ><FONT COLOR="RED" >define host {</FONT ></FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > alias localhost</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" > _ANOTHERCUSTOMVAR test2</FONT ></P ><P ><FONT COLOR="RED" > _MYCUSTOMVAR test</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN305" >4.5. Hostgroups</A ></H2 ><P >You can define hostgroups in two ways. To define by object class       nagiosHostgroups is just as possible as define by object class       nagiosHost. Do it in the way you want.</P ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN308" >4.5.1. Object class nagiosHostgroup</A ></H3 ><P >For adding a new Hostgroup to LConf, just create a new LDAP         entry and choose object class nagiosHostgroup. A bit special are the         attributes cn and description. cn will be the title of the entry and         description is an additional attribute for leaving comments.         Everything else you can treat like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN316" >4.5.2. Object class nagiosHost</A ></H3 ><P >For adding a host to a hostgroup, just edit the existing LDAP         host entry at the attribute nagiosHostgroups. You can treat the         attribute like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /         <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN324" >4.5.3. Assign a services to a hostgroup</A ></H3 ><P >To assign a service (see Chapter 4, 4 Services) to a hostgroup,         simply create or move the service below a hostgroup object class. All         hosts in this hostgroup will get this service after running         LConfExport.pl.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ></DIV ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN330" >4.6. Host Dependencies</A ></H2 ><P >For adding a new host dependency to LConf, just edit an existing       host entry and fill the attributes nagiosHostDependency and       nagiosHostDependencyExecutionFailureCriteria. The attribute       nagiosHostDependencyNotificationFailureCriteria is optional.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl hosts config file will look like       this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host </FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > alias localhost </FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define hostdependency {</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost </FONT ></P ><P ><FONT COLOR="RED" > dependent_host_name localhost </FONT ></P ><P ><FONT COLOR="RED" > execution_failure_criteria d,u </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN361" >4.7. Service Dependencies</A ></H2 ><P >For adding a new service dependency to LConf, just edit an       existing service entry and fill the attributes nagiosServiceDependency       and nagiosServiceDependencyExecutionFailureCriteria. The attribute       nagiosServiceDependencyNotificationFailureCriteria is optional.</P ><P >The attribute nagiosServiceDependency is a bit special. You have       to specify it in the way HOSTNAME -&#62; SERVICE</P ><P >The sign -&#62; will act as separator between host and service. In       the example below it means: SSH depends on service PING of       localhost.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl hosts config file will look like       this:</P ><P ><FONT COLOR="RED" >define host { </FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > alias localhost</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description SSH</FONT ></P ><P ><FONT COLOR="RED" > host_name localhost</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ssh</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define servicedependency { </FONT ></P ><P ><FONT COLOR="RED" > host_name localhost </FONT ></P ><P ><FONT COLOR="RED" > service_description PING </FONT ></P ><P ><FONT COLOR="RED" > dependent_host_name localhost </FONT ></P ><P ><FONT COLOR="RED" > dependent_service_description SSH </FONT ></P ><P ><FONT COLOR="RED" > execution_failure_criteria w,c,u</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN426" >4.8. Inheritance</A ></H2 ><P >With LConf it is possible to inherit host- and service attributes       or complete service objects down the LDAP tree. Each object class       nagiosStructuralObject can be used for inheritance. An object class       nagiosStructuralObject looks like this:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >As you can imagine, *Host* attributes are used for host       inheritance and *Service* attributes for service inheritance. For more       detailed information about host- and service inheritance, read       below...</P ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN433" >4.8.1. Host attributes</A ></H3 ><P >Starting point are the two hosts testhost1 and testhost2.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >For this scenario, the generated config file will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host { </FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P >To assign a host attribute to both hosts you have to edit the         nagiosStructuralObject which is the lowest common denominator. In our         simple example it's ou=NagiosConfig. For example, we want to assign         the contactgroup MyInfrastructureTeam to both hosts, it will look like         this in the LDAP editor:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > # from:         ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P ><FONT COLOR="RED" > contact_groups MyInfrastructureTeam</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1 </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > # from:         ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P ><FONT COLOR="RED" > contact_groups MyInfrastructureTeam</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P >Of course, you can treat the attributes like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config. Comma seperated lists         like MyInfrastructureTeam,SecondLevel,Management are also         possible.</P ><P >As you have probably noticed, LConf adds a comment line above         all inherited attributes. This comment tells you where you can find         the inheritance. This will help if your config grows.</P ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN509" >4.8.2. Service attributes</A ></H3 ><P >Starting point are the two hosts testhost1 and testhost2. For         each host a service PING is defined.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >For this scenario, the generated config file will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > check_command         check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host { </FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > check_command         check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P >To assign a service attribute to both PING services you have to         edit the nagiosStructuralObject which is the lowest common         denominator. In our simple example it's ou=NagiosConfig. For example,         we want to assign the contactgroup MyInfrastructureTeam to both PING         services, it will look like this in the LDAP editor:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1 </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > # from:         ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P ><FONT COLOR="RED" > contact_groups MyInfrastructureTeam</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ping!100.0,20%!500.0,60%         </FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > # from:         ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P ><FONT COLOR="RED" > contact_groups MyInfrastructureTeam</FONT ></P ><P ><FONT COLOR="RED" > check_command         check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P >Of course, you can treat the attributes like a <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; config. Comma seperated lists         like MyInfrastructureTeam,SecondLevel,Management are also         possible.</P ><P >As you have probably noticed, LConf adds a comment line above         all inherited attributes. This comment tells you where you can find         the inheritance. This will help if your config grows.</P ></DIV ><DIV CLASS="sect2" ><HR><H3 CLASS="sect2" ><A NAME="AEN640" >4.8.3. Services</A ></H3 ><P >Starting point are the two hosts testhost1 and testhost2.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >For this scenario, the generated config file will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host { </FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P >To assign a service to both hosts you have to create an object         class nagiosService below the nagiosStructuralObject which is the         lowest common denominator. In our simple example it's ou=NagiosConfig.         For example, we want to assign a service PING to both hosts, it will         look like this in the LDAP editor:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >After running LConfExport.pl the config will look like         this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1 </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" ># from:         cn=PING,ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description PING</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > check_command         check_ping!100.0,20%!500.0,60%</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ></P ><P ><FONT COLOR="RED" ># from:         cn=PING,ou=NagiosConfig,ou=LConf,dc=netways,dc=org</FONT ></P ><P >define service {</P ><P >use generic-service</P ><P >service_description PING</P ><P >host_name testhost2</P ><P >check_command check_ping!100.0,20%!500.0,60%</P ><P >}</P ><P >As you have probably noticed, LConf adds a comment line above         all inherited services. This comment tells you where you can find the         inherited service. This will help if your config grows.</P ></DIV ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN730" >4.9. Templates / Profiles</A ></H2 ><P >Templates or Profiles. Name it the way you want... ;-) Here we       go!</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >For both hosts are no services specified at the moment. First of       all, we will create a template default-linux. For this purpose we create       an object class nagiosStructuralObject below ou=Templates and add a       service SSH (adding services, see Chapter 4, 4 Services) to       default-linux.</P ><P >This should look like this:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >Now, our template default-linux contains a SSH check. To link a       template to a list of hosts we need a LDAP alias. An example of a LDAP       alias could be found in ou=Examples. Copy the alias to ou=NagiosConfig       (the alias will be inherited to testhost1 and testhost2) and rename it       the way you want.</P ><P >After that, the LDAP tree should look like this:</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >At this point we have to edit the target of the alias. In our       example the target should be       ou=default-linux,ou=Templates,ou=LConf,dc=netways,dc=org</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >During config export with LConfExport.pl, the script will find the       alias link-to-default-linux with it's target ou=default-linux and will       assign all services below ou=default-linux to testhost1 and       testhost2.</P ><P >After running LConfExport.pl hosts config file will look like       this:</P ><P ><FONT COLOR="RED" >define host {</FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > alias testhost1</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" ># from:       cn=SSH,ou=default-linux,ou=Templates,ou=LConf,dc=netways,dc=org       </FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description SSH</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost1</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ssh</FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" >define host { </FONT ></P ><P ><FONT COLOR="RED" > use generic-host</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > alias testhost2</FONT ></P ><P ><FONT COLOR="RED" > address 127.0.0.1 </FONT ></P ><P ><FONT COLOR="RED" >}</FONT ></P ><P ><FONT COLOR="RED" ></FONT ></P ><P ><FONT COLOR="RED" ># from:       cn=SSH,ou=default-linux,ou=Templates,ou=LConf,dc=netways,dc=org       </FONT ></P ><P ><FONT COLOR="RED" >define service {</FONT ></P ><P ><FONT COLOR="RED" > use generic-service</FONT ></P ><P ><FONT COLOR="RED" > service_description SSH</FONT ></P ><P ><FONT COLOR="RED" > host_name testhost2</FONT ></P ><P ><FONT COLOR="RED" > check_command check_ssh </FONT ></P ><P ><FONT COLOR="RED" >} </FONT ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN810" >4.10. nagiosHostDisable / nagiosServiceDisable</A ></H2 ><P >To disable a host and/or a service simply fill the attributes       nagiosHostDisable or nagiosServiceDisable with any text. If LConf       detects during config export that a disable attribute is set (not empty       and not 0), the host and/or service will be excluded.</P ><P >Of course you can find nagiosHostDisable and nagiosServiceDisable       in object class nagiosStructuralObject, too. So inheritance is also       possible.</P ></DIV ></DIV ><DIV CLASS="chapter" ><HR><H1 ><A NAME="AEN814" ></A >Chapter 5. Multiple <SPAN CLASS="trademark" >Icinga</SPAN >&reg; /     <SPAN CLASS="trademark" >Nagios</SPAN >&reg; Servers</H1 ><P >Managing multiple <SPAN CLASS="trademark" >Nagios</SPAN >&reg; /     <SPAN CLASS="trademark" >Icinga</SPAN >&reg; servers with LConf is not     difficult. Starting point is this scenario...</P ><P >We have two Icinga servers, called MyIcingaServer-1 and     MyIcingaServer-2. Both are monitoring different linux servers.</P ><P >The "folders" MyIcingaServer-1 and MyIcingaServer-2 are     nagiosStructuralObject object classes. They are to form a     structure...</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN826" >5.1. Export the whole <SPAN CLASS="trademark" >Icinga</SPAN >&reg;       / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; configuration</A ></H2 ><P >First of all you have to export the config in a folder. We'll take       /usr/local/icinga/etc/MyCustomConfig in this example.</P ><P ><FONT COLOR="RED" >nagios@lconf-doku:/usr/local/LConf$ ./LConfExport.pl -o       /tmp/LConf</FONT ></P ><P >Now, the configuration of both servers is stored in       /tmp/LConf.</P ><P >By the way... this config could be used to create a master / slave       environment :-)</P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN835" >5.2. Tell LConf about multiple servers</A ></H2 ><P >Due to editing of the suitable nagiosStructuralObject, LConf knows       which part of the config should be exported to each host.</P ><P >As you can see below, you have to enter the information into a       description line. The description attribute can be specified multiple       times.</P ><P >It's important to write the right syntax into attributes line.       LCONF-&#62;EXPORT-&#62;CLUSTER = &#60;name of my server&#62;.</P ><DIV CLASS="mediaobject" ><P ></P ></DIV ><P >If you have a structural object which should be exported to all       servers (e.g. one that includes commands, contacts, ...), simply       describe it with LCONF-&#62;EXPORT-&#62;GLOBAL.</P ></DIV ><DIV CLASS="sect1" ><HR><H2 CLASS="sect1" ><A NAME="AEN844" >5.3. Deploy config per server</A ></H2 ><P >To export each Icinga servers config, LConfSlaveExport is your       friend!</P ><P ><FONT COLOR="RED" >nagios@lconf-doku:/usr/local/LConf$ ./LConfSlaveExport.pl -H       MyIcingaServer-1 -s /tmp/LConf -t       /usr/local/icinga/etc/MyConfig</FONT ></P ><P >The script will now search after descriptions like       LCONF-&#62;EXPORT-&#62;GLOBAL and LCONF-&#62;EXPORT-&#62;CLUSTER =       MyIcingaServer-1 and will push the config to MyIcingaServer-1 via SSH       and SCP (ssh pub key exchange needed).</P ><P >LConfSlaveExport.pl can also reload <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg; after config deployment. This       feature is disabled per default, because not every admin is happy about       it. To enable the feature you have to edit LConfSlaveExport.pl.</P ><P >There are the following lines:</P ><P ><FONT COLOR="RED" ># reload nagios on slave</FONT ></P ><P ><FONT COLOR="RED" >#beVerbose("RELOAD", "ssh $optSlave '/etc/init.d/icinga       reload'");</FONT ></P ><P ><FONT COLOR="RED" >#my $result = qx(ssh $optSlave '/etc/init.d/icinga       reload');</FONT ></P ><P ><FONT COLOR="RED" >#print $result;</FONT ></P ><P >Uncomment them and LConfSlaveExport.pl will reload <SPAN CLASS="trademark" >Icinga</SPAN >&reg; / <SPAN CLASS="trademark" >Nagios</SPAN >&reg;</P ></DIV ></DIV ></DIV ></BODY ></HTML >